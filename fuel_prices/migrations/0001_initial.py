# Generated by Django 5.2.7 on 2025-11-21 22:25

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('accounts', '0004_alter_organization_address_alter_organization_cnpj_and_more'),
        ('erp_hub', '0003_centrolubrificacao_lojaconveniencia'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Fuel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Nome do combust√≠vel (ex: Gasolina Comum)', max_length=100, unique=True, verbose_name='Nome')),
                ('code', models.CharField(help_text='C√≥digo interno (ex: GC, DS10, ET)', max_length=10, unique=True, verbose_name='C√≥digo Interno')),
                ('anp_code', models.CharField(blank=True, help_text='C√≥digo oficial da ANP (ex: 320101 para Gasolina C)', max_length=20, verbose_name='C√≥digo ANP')),
                ('fuel_type', models.CharField(choices=[('gasoline_common', 'Gasolina Comum'), ('gasoline_premium', 'Gasolina Aditivada'), ('ethanol', 'Etanol (√Ålcool)'), ('diesel_s10', 'Diesel S10'), ('diesel_s500', 'Diesel S500'), ('gnv', 'GNV (G√°s Natural Veicular)')], help_text='Categoria do combust√≠vel', max_length=30, verbose_name='Tipo')),
                ('unit', models.CharField(default='litro', help_text='Unidade de medida (litro, m¬≥, kg)', max_length=10, verbose_name='Unidade')),
                ('density', models.DecimalField(blank=True, decimal_places=3, help_text='Densidade aproximada (ex: 0.750 para gasolina)', max_digits=5, null=True, verbose_name='Densidade (kg/L)')),
                ('description', models.TextField(blank=True, help_text='Informa√ß√µes t√©cnicas e caracter√≠sticas', verbose_name='Descri√ß√£o')),
                ('is_active', models.BooleanField(default=True, help_text='Se est√° dispon√≠vel para comercializa√ß√£o', verbose_name='Ativo')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Criado em')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Atualizado em')),
            ],
            options={
                'verbose_name': 'Combust√≠vel',
                'verbose_name_plural': 'Combust√≠veis',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Supplier',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Nome oficial da empresa', max_length=200, verbose_name='Raz√£o Social')),
                ('brand', models.CharField(help_text='Nome comercial (ex: Vibra, Shell, Ipiranga)', max_length=100, verbose_name='Marca/Bandeira')),
                ('cnpj', models.CharField(help_text='CNPJ da distribuidora', max_length=18, unique=True, verbose_name='CNPJ')),
                ('contact_name', models.CharField(blank=True, help_text='Representante comercial', max_length=200, verbose_name='Nome do Contato')),
                ('contact_phone', models.CharField(blank=True, max_length=20, verbose_name='Telefone')),
                ('contact_email', models.EmailField(blank=True, max_length=254, verbose_name='Email')),
                ('portal_url', models.URLField(blank=True, help_text='URL do sistema web da distribuidora', verbose_name='URL do Portal')),
                ('has_web_scraping', models.BooleanField(default=False, help_text='Se temos scraper configurado para este fornecedor', verbose_name='Possui Scraping')),
                ('notes', models.TextField(blank=True, help_text='Condi√ß√µes especiais, hist√≥rico de negocia√ß√µes', verbose_name='Observa√ß√µes')),
                ('is_active', models.BooleanField(default=True, verbose_name='Ativo')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Criado em')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Atualizado em')),
            ],
            options={
                'verbose_name': 'Fornecedor',
                'verbose_name_plural': 'Fornecedores',
                'ordering': ['brand'],
            },
        ),
        migrations.CreateModel(
            name='PurchasePrice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('unit_price', models.DecimalField(decimal_places=3, help_text='Pre√ßo por litro SEM frete (ex: R$ 4,500)', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.001'))], verbose_name='Pre√ßo Unit√°rio (Base)')),
                ('volume_liters', models.DecimalField(decimal_places=2, help_text='Quantidade de litros comprada (ex: 10000.00)', max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))], verbose_name='Volume (Litros)')),
                ('total_value', models.DecimalField(decimal_places=2, help_text='Valor total da nota fiscal (unit_price * volume + frete)', max_digits=12, verbose_name='Valor Total da NF')),
                ('freight_mode', models.CharField(choices=[('CIF', 'CIF (Vendedor paga frete)'), ('FOB', 'FOB (Comprador paga frete)')], default='CIF', help_text='CIF = Vendedor paga | FOB = Comprador paga', max_length=3, verbose_name='Modalidade de Frete')),
                ('freight_value', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Custo do frete em reais (R$ 0,00 se CIF)', max_digits=10, verbose_name='Valor do Frete')),
                ('freight_per_liter', models.DecimalField(decimal_places=3, default=Decimal('0.000'), help_text='Calculado: freight_value / volume_liters', max_digits=6, verbose_name='Frete por Litro')),
                ('final_unit_cost', models.DecimalField(decimal_places=3, help_text='unit_price + freight_per_liter (CUSTO REAL)', max_digits=10, verbose_name='Custo Final por Litro')),
                ('payment_term_type', models.CharField(choices=[('antecipado', 'Antecipado (√Ä Vista)'), ('prazo', 'A Prazo')], default='prazo', help_text='Antecipado (√† vista) ou A Prazo', max_length=20, verbose_name='Tipo de Prazo')),
                ('payment_term_days', models.IntegerField(default=30, help_text='0 = √† vista | 7, 15, 30, 60, 90 dias', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(365)], verbose_name='Prazo (Dias)')),
                ('early_payment_discount_percent', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='% de desconto se pagar √† vista (ex: 2.00 = 2%)', max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00')), django.core.validators.MaxValueValidator(Decimal('100.00'))], verbose_name='Desconto Antecipado (%)')),
                ('payment_due_date', models.DateField(help_text='invoice_date + payment_term_days', verbose_name='Vencimento')),
                ('invoice_number', models.CharField(help_text='N√∫mero da nota fiscal', max_length=50, verbose_name='N√∫mero da NF')),
                ('invoice_date', models.DateField(help_text='Data de emiss√£o da nota fiscal', verbose_name='Data da NF')),
                ('invoice_file', models.FileField(blank=True, help_text='Upload do PDF da nota fiscal (opcional)', null=True, upload_to='fuel_invoices/%Y/%m/', verbose_name='Arquivo da NF')),
                ('notes', models.TextField(blank=True, help_text='Negocia√ß√µes especiais, condi√ß√µes extras', verbose_name='Observa√ß√µes')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Criado em')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Atualizado em')),
                ('created_by', models.ForeignKey(help_text='Usu√°rio que registrou esta compra', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='fuel_purchases_created', to=settings.AUTH_USER_MODEL)),
                ('fuel', models.ForeignKey(help_text='Tipo de combust√≠vel comprado', on_delete=django.db.models.deletion.PROTECT, related_name='purchases', to='fuel_prices.fuel')),
                ('organization', models.ForeignKey(help_text='Organiza√ß√£o que fez a compra', on_delete=django.db.models.deletion.CASCADE, related_name='fuel_purchases', to='accounts.organization')),
                ('store', models.ForeignKey(help_text='Qual posto/loja comprou este combust√≠vel', on_delete=django.db.models.deletion.CASCADE, related_name='fuel_purchases', to='erp_hub.store')),
                ('supplier', models.ForeignKey(help_text='Distribuidora que vendeu', on_delete=django.db.models.deletion.PROTECT, related_name='sales', to='fuel_prices.supplier')),
            ],
            options={
                'verbose_name': 'Compra de Combust√≠vel',
                'verbose_name_plural': 'Compras de Combust√≠vel',
                'ordering': ['-invoice_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ScrapedPrice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('unit_price', models.DecimalField(decimal_places=3, help_text='Pre√ßo por litro coletado do site', max_digits=10, verbose_name='Pre√ßo Unit√°rio')),
                ('freight_mode', models.CharField(blank=True, choices=[('CIF', 'CIF (Vendedor paga frete)'), ('FOB', 'FOB (Comprador paga frete)')], help_text='CIF ou FOB (se o site informar)', max_length=3, null=True, verbose_name='Modalidade de Frete')),
                ('freight_included', models.BooleanField(default=True, help_text='Se o pre√ßo j√° inclui frete (CIF)', verbose_name='Frete Inclu√≠do')),
                ('payment_term_days', models.IntegerField(blank=True, help_text='Prazo de pagamento (se o site informar)', null=True, verbose_name='Prazo (Dias)')),
                ('source', models.CharField(choices=[('vibra_portal', 'Portal Vibra Energia'), ('anp', 'ANP (Dados Oficiais)'), ('manual', 'Entrada Manual'), ('ipiranga', 'Portal Ipiranga'), ('raizen', 'Portal Ra√≠zen')], help_text='De onde veio este pre√ßo', max_length=30, verbose_name='Fonte')),
                ('source_url', models.URLField(blank=True, help_text='P√°gina onde foi coletado', verbose_name='URL de Origem')),
                ('scraped_at', models.DateTimeField(help_text='Data/hora da coleta', verbose_name='Coletado em')),
                ('raw_data', models.JSONField(blank=True, help_text='JSON completo coletado do site (para debug)', null=True, verbose_name='Dados Brutos')),
                ('is_valid', models.BooleanField(default=True, help_text='Se consideramos este pre√ßo confi√°vel', verbose_name='V√°lido')),
                ('validation_notes', models.TextField(blank=True, help_text='Por que marcamos como inv√°lido (se aplic√°vel)', verbose_name='Notas de Valida√ß√£o')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Criado em')),
                ('fuel', models.ForeignKey(help_text='Tipo de combust√≠vel', on_delete=django.db.models.deletion.CASCADE, related_name='scraped_prices', to='fuel_prices.fuel')),
                ('store', models.ForeignKey(help_text='Para qual posto este pre√ßo foi coletado', on_delete=django.db.models.deletion.CASCADE, related_name='scraped_prices', to='erp_hub.store')),
                ('supplier', models.ForeignKey(help_text='Distribuidora que oferece este pre√ßo', on_delete=django.db.models.deletion.CASCADE, related_name='scraped_prices', to='fuel_prices.supplier')),
            ],
            options={
                'verbose_name': 'Pre√ßo Coletado (Scraping)',
                'verbose_name_plural': 'Pre√ßos Coletados (Scraping)',
                'ordering': ['-scraped_at'],
            },
        ),
        migrations.CreateModel(
            name='ScrapingLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('source', models.CharField(choices=[('vibra_portal', 'Portal Vibra Energia'), ('anp', 'ANP (Dados Oficiais)'), ('manual', 'Entrada Manual'), ('ipiranga', 'Portal Ipiranga'), ('raizen', 'Portal Ra√≠zen')], help_text='Qual site foi acessado', max_length=30, verbose_name='Fonte')),
                ('started_at', models.DateTimeField(help_text='Quando come√ßou a execu√ß√£o', verbose_name='Iniciado em')),
                ('finished_at', models.DateTimeField(blank=True, help_text='Quando terminou (NULL se ainda rodando)', null=True, verbose_name='Finalizado em')),
                ('duration_seconds', models.IntegerField(blank=True, help_text='Tempo total de execu√ß√£o', null=True, verbose_name='Dura√ß√£o (s)')),
                ('status', models.CharField(choices=[('running', 'üîÑ Executando'), ('success', '‚úÖ Sucesso'), ('partial', '‚ö†Ô∏è Parcial'), ('failed', '‚ùå Falhou')], default='running', max_length=20, verbose_name='Status')),
                ('prices_collected', models.IntegerField(default=0, help_text='Quantos pre√ßos foram salvos', verbose_name='Pre√ßos Coletados')),
                ('errors_count', models.IntegerField(default=0, help_text='Quantidade de erros encontrados', verbose_name='Erros')),
                ('error_message', models.TextField(blank=True, help_text='Descri√ß√£o do erro (se houver)', verbose_name='Mensagem de Erro')),
                ('log_details', models.JSONField(blank=True, help_text='Informa√ß√µes t√©cnicas da execu√ß√£o', null=True, verbose_name='Detalhes do Log')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Criado em')),
                ('supplier', models.ForeignKey(blank=True, help_text='Fornecedor relacionado', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='scraping_logs', to='fuel_prices.supplier')),
            ],
            options={
                'verbose_name': 'Log de Scraping',
                'verbose_name_plural': 'Logs de Scraping',
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='PriceAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('alert_type', models.CharField(choices=[('internal_divergence', '‚ö†Ô∏è Diverg√™ncia Entre Postos'), ('better_price', 'üí° Pre√ßo Melhor Dispon√≠vel'), ('better_terms', 'üìÖ Condi√ß√µes Melhores (Prazo/Frete)'), ('early_payment', 'üí∞ Desconto Antecipado Dispon√≠vel'), ('price_increase', 'üìà Aumento de Pre√ßo Detectado'), ('price_decrease', 'üìâ Redu√ß√£o de Pre√ßo Detectada')], help_text='Categoria do alerta', max_length=30, verbose_name='Tipo de Alerta')),
                ('priority', models.CharField(choices=[('high', 'üî¥ Alta'), ('medium', 'üü° M√©dia'), ('low', 'üü¢ Baixa')], default='medium', help_text='Alta/M√©dia/Baixa', max_length=10, verbose_name='Prioridade')),
                ('current_price', models.DecimalField(decimal_places=3, help_text='Pre√ßo que voc√™ est√° pagando', max_digits=10, verbose_name='Pre√ßo Atual')),
                ('better_price', models.DecimalField(blank=True, decimal_places=3, help_text='Pre√ßo melhor dispon√≠vel (se aplic√°vel)', max_digits=10, null=True, verbose_name='Pre√ßo Melhor')),
                ('price_difference', models.DecimalField(decimal_places=3, help_text='Quanto voc√™ est√° pagando a mais', max_digits=8, verbose_name='Diferen√ßa (R$/L)')),
                ('potential_savings', models.DecimalField(blank=True, decimal_places=2, help_text='Quanto economizaria (baseado em volume m√©dio)', max_digits=12, null=True, verbose_name='Economia Potencial (R$)')),
                ('title', models.CharField(help_text='T√≠tulo curto do alerta', max_length=200, verbose_name='T√≠tulo')),
                ('message', models.TextField(help_text='Descri√ß√£o completa do alerta', verbose_name='Mensagem')),
                ('is_read', models.BooleanField(default=False, help_text='Se o gestor j√° visualizou', verbose_name='Lido')),
                ('read_at', models.DateTimeField(blank=True, null=True, verbose_name='Lido em')),
                ('is_dismissed', models.BooleanField(default=False, help_text='Se foi descartado/ignorado', verbose_name='Dispensado')),
                ('dismissed_reason', models.TextField(blank=True, help_text='Por que foi ignorado', verbose_name='Motivo da Dispensa')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Criado em')),
                ('expires_at', models.DateTimeField(blank=True, help_text='Ap√≥s esta data, alerta perde relev√¢ncia', null=True, verbose_name='Expira em')),
                ('organization', models.ForeignKey(help_text='Organiza√ß√£o que recebe o alerta', on_delete=django.db.models.deletion.CASCADE, related_name='fuel_alerts', to='accounts.organization')),
                ('read_by', models.ForeignKey(blank=True, help_text='Usu√°rio que leu o alerta', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='fuel_alerts_read', to=settings.AUTH_USER_MODEL)),
                ('compared_purchase', models.ForeignKey(blank=True, help_text='Segunda compra para compara√ß√£o (diverg√™ncia interna)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='comparison_alerts', to='fuel_prices.purchaseprice')),
                ('purchase_price', models.ForeignKey(blank=True, help_text='Compra que gerou o alerta (se aplic√°vel)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='alerts', to='fuel_prices.purchaseprice')),
                ('scraped_price', models.ForeignKey(blank=True, help_text='Pre√ßo coletado que gerou o alerta (se aplic√°vel)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='alerts', to='fuel_prices.scrapedprice')),
            ],
            options={
                'verbose_name': 'Alerta de Pre√ßo',
                'verbose_name_plural': 'Alertas de Pre√ßo',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['organization', '-created_at'], name='fuel_prices_organiz_944a6b_idx'), models.Index(fields=['is_read', '-created_at'], name='fuel_prices_is_read_bbf90d_idx'), models.Index(fields=['priority', '-created_at'], name='fuel_prices_priorit_ef7ac3_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='scrapedprice',
            index=models.Index(fields=['store', 'fuel', '-scraped_at'], name='fuel_prices_store_i_61c6f7_idx'),
        ),
        migrations.AddIndex(
            model_name='scrapedprice',
            index=models.Index(fields=['supplier', '-scraped_at'], name='fuel_prices_supplie_85c489_idx'),
        ),
        migrations.AddIndex(
            model_name='scrapedprice',
            index=models.Index(fields=['-scraped_at'], name='fuel_prices_scraped_08051e_idx'),
        ),
        migrations.AddIndex(
            model_name='purchaseprice',
            index=models.Index(fields=['store', 'fuel', '-invoice_date'], name='fuel_prices_store_i_f8ca81_idx'),
        ),
        migrations.AddIndex(
            model_name='purchaseprice',
            index=models.Index(fields=['supplier', '-invoice_date'], name='fuel_prices_supplie_b02fef_idx'),
        ),
        migrations.AddIndex(
            model_name='purchaseprice',
            index=models.Index(fields=['invoice_date'], name='fuel_prices_invoice_3a6a74_idx'),
        ),
    ]
