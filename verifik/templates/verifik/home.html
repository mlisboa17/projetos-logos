{% extends 'base.html' %}

{% block title %}VerifiK - Dashboard{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h1><i class="bi bi-camera-video me-2"></i>VerifiK - Dashboard</h1>
            <p class="text-muted">Monitoramento inteligente de vendas com IA</p>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-box me-2"></i>Produtos Cadastrados</h5>
                    <h2 class="mb-0">{{ total_produtos }}</h2>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card border-success">
                <div class="card-body">
                    <h5 class="card-title text-success"><i class="bi bi-camera me-2"></i>C√¢meras Ativas</h5>
                    <h2 class="mb-0 text-success">{{ total_cameras }}</h2>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card border-primary">
                <div class="card-body">
                    <h5 class="card-title text-primary"><i class="bi bi-cart-check me-2"></i>Vendas Hoje</h5>
                    <h2 class="mb-0 text-primary">{{ vendas_hoje }}</h2>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card border-warning">
                <div class="card-body">
                    <h5 class="card-title text-warning"><i class="bi bi-eye me-2"></i>Detec√ß√µes Hoje</h5>
                    <h2 class="mb-0 text-warning">{{ deteccoes_hoje }}</h2>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card border-danger">
                <div class="card-body">
                    <h5 class="card-title text-danger"><i class="bi bi-exclamation-triangle me-2"></i>Incidentes Abertos</h5>
                    <h2 class="mb-0 text-danger">{{ incidentes_abertos }}</h2>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card border-info">
                <div class="card-body">
                    <h5 class="card-title text-info"><i class="bi bi-people me-2"></i>Funcion√°rios Ativos</h5>
                    <h2 class="mb-0 text-info">{{ total_funcionarios }}</h2>
                </div>
            </div>
        </div>
    </div>

    {% if incidentes_abertos > 0 %}
    <div class="card">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>√öltimos Incidentes</h5>
        </div>
        <div class="card-body">
            {% if ultimos_incidentes %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Tipo</th>
                            <th>Produto</th>
                            <th>C√¢mera</th>
                            <th>Severidade</th>
                            <th>Status</th>
                        </tr>
                    </thead>
        <tbody>
            {% for incidente in ultimos_incidentes %}
            <tr>
                <td>{{ incidente.created_at|date:"d/m/Y H:i" }}</td>
                <td>{{ incidente.get_tipo_display }}</td>
                <td>{{ incidente.deteccao.produto_identificado.descricao_produto|default:"Desconhecido" }}</td>
                <td>{{ incidente.deteccao.camera.nome|default:"N/A" }}</td>
                <td>
                    {% if incidente.severidade == 'ALTA' %}
                        <span class="badge badge-danger">{{ incidente.get_severidade_display }}</span>
                    {% elif incidente.severidade == 'MEDIA' %}
                        <span class="badge badge-warning">{{ incidente.get_severidade_display }}</span>
                    {% else %}
                        <span class="badge badge-info">{{ incidente.get_severidade_display }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if incidente.status == 'ABERTO' %}
                        <span class="badge badge-danger">{{ incidente.get_status_display }}</span>
                    {% elif incidente.status == 'EM_ANALISE' %}
                        <span class="badge badge-warning">{{ incidente.get_status_display }}</span>
                    {% else %}
                        <span class="badge badge-success">{{ incidente.get_status_display }}</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #7f8c8d;">Nenhum incidente registrado ainda.</p>
    {% endif %}
</div>
{% endif %}

<div class="card">
    <h2>üìä Produtos Mais Detectados (Hoje)</h2>
    {% if produtos_top %}
    <table>
        <thead>
            <tr>
                <th>Produto</th>
                <th>Total de Detec√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for item in produtos_top %}
            <tr>
                <td>{{ item.produto_identificado__descricao_produto }}</td>
                <td><strong>{{ item.total }}</strong></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #7f8c8d;">Nenhuma detec√ß√£o registrada hoje.</p>
    {% endif %}
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
    <div class="card">
        <h2>üöÄ A√ß√µes R√°pidas</h2>
        <a href="{% url 'verifik_produtos_lista' %}" class="btn" style="margin-right: 1rem;">Ver Produtos</a>
        <a href="/admin/verifik/incidente/" class="btn" style="background: #e74c3c;">Gerenciar Incidentes</a>
    </div>
    
    <div class="card">
        <h2>‚ÑπÔ∏è Informa√ß√µes do Sistema</h2>
        <p><strong>Sistema:</strong> VerifiK v1.0</p>
        <p><strong>IA:</strong> YOLOv8 + Transfer Learning</p>
        <p><strong>Status:</strong> <span class="badge badge-success">Online</span></p>
    </div>
</div>
{% endblock %}
